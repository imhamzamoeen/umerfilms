# Story 4.5: Off-Canvas Fullscreen Menu

## Status
Draft

## Story
**As a** visitor,
**I want** a fullscreen menu that slides in when I click the menu button,
**so that** I can navigate the site with a rich interactive experience.

## Acceptance Criteria

1. Pill-shaped "Menu" button added to header (top right)
2. Menu button has white background, black text, purple dot indicator
3. Clicking menu button toggles fullscreen overlay
4. Overlay has dark background with navigation links
5. Navigation links are large and prominent in overlay
6. Smooth expand/collapse animation (0.4s ease-out)
7. Clicking link or outside overlay closes menu
8. Menu is keyboard accessible (Escape key closes)
9. Focus trapped within menu when open
10. Mobile responsive (works on all screen sizes)
11. Component tests verify menu toggle functionality
12. Accessibility tested (ARIA labels, focus management)

## Tasks / Subtasks

- [ ] Task 1: Create Menu Toggle Button (AC: 1, 2)
  - [ ] Create pill-shaped button in header (top right)
  - [ ] Style with white background, black text
  - [ ] Add purple dot indicator after "MENU •"
  - [ ] Use purple-pink accent color for dot
  - [ ] Add hover state (inverts to black bg, white text)

- [ ] Task 2: Create OffCanvasMenu Component (AC: 3, 4)
  - [ ] Create `src/components/layout/OffCanvasMenu.tsx`
  - [ ] Implement fullscreen overlay (100vw × 100vh)
  - [ ] Add dark background (#000000 or rgba(0,0,0,0.95))
  - [ ] Position overlay fixed with z-index above content
  - [ ] Add navigation links structure

- [ ] Task 3: Style Navigation Links (AC: 5)
  - [ ] Make links large (3-4rem font size)
  - [ ] Center align navigation list
  - [ ] Use white text color
  - [ ] Add spacing between links (2-3rem)
  - [ ] Add hover effects (purple-pink gradient underline)

- [ ] Task 4: Implement Slide Animation (AC: 6)
  - [ ] Add slide-in animation from right (translateX)
  - [ ] Set animation duration to 0.4s
  - [ ] Use ease-out easing curve
  - [ ] Add backdrop fade-in (opacity 0 → 1)
  - [ ] Reverse animation on close

- [ ] Task 5: Toggle Menu Functionality (AC: 3, 7)
  - [ ] Create state for menu open/closed
  - [ ] Toggle state on button click
  - [ ] Close menu when navigation link clicked
  - [ ] Close menu when clicking outside (backdrop)
  - [ ] Prevent body scroll when menu open

- [ ] Task 6: Keyboard Accessibility (AC: 8, 9)
  - [ ] Add Escape key listener to close menu
  - [ ] Implement focus trap within menu when open
  - [ ] Return focus to menu button on close
  - [ ] Make all links keyboard navigable
  - [ ] Add Tab navigation within menu

- [ ] Task 7: ARIA Attributes & Accessibility (AC: 12)
  - [ ] Add aria-expanded to menu button
  - [ ] Add aria-label to menu button
  - [ ] Add role="dialog" to overlay
  - [ ] Add aria-modal="true" to overlay
  - [ ] Test with screen readers (NVDA, JAWS)

- [ ] Task 8: Responsive Design (AC: 10)
  - [ ] Test on mobile (320px-768px)
  - [ ] Test on tablet (768px-1024px)
  - [ ] Test on desktop (1024px+)
  - [ ] Adjust font sizes for mobile
  - [ ] Ensure touch targets are adequate (44px min)

- [ ] Task 9: Component Testing (AC: 11)
  - [ ] Create `OffCanvasMenu.test.tsx`
  - [ ] Test menu opens on button click
  - [ ] Test menu closes on link click
  - [ ] Test menu closes on Escape key
  - [ ] Test focus trap functionality

- [ ] Task 10: Integration with Header
  - [ ] Update Header component with menu button
  - [ ] Position button in top right corner
  - [ ] Ensure menu overlays all content
  - [ ] Test with existing navigation
  - [ ] Update header tests

## Dev Notes

### Off-Canvas Menu Specification
[Source: idea.md - Navigation section, changes.md section 5]

**From idea.md:**
- Pill-shaped "Menu" button in top right
- White background, black text, tiny purple dot
- Toggles fullscreen overlay
- Dark background overlay with large navigation links
- Smooth expand/collapse animation

**Current Implementation:**
- Simple inline navigation links in header
- No toggle mechanism or overlay

**Required Changes:**
- Create off-canvas menu component
- Add menu toggle button
- Implement fullscreen overlay
- Add smooth animations

### Menu Button Design
[Source: idea.md - Buttons section]

**Button Styling:**
```tsx
// Menu button
<button
  className="menu-toggle"
  aria-expanded={isOpen}
  aria-label="Toggle navigation menu"
>
  <span>MENU</span>
  <span className="purple-dot">•</span>
</button>
```

**CSS Styles:**
```css
.menu-toggle {
  background: #FFFFFF;
  color: #000000;
  padding: 0.75rem 1.5rem;
  border-radius: 2rem; /* Pill shape */
  border: none;
  font-size: 0.875rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  cursor: pointer;
  transition: all 0.3s ease;
}

.menu-toggle:hover {
  background: #000000;
  color: #FFFFFF;
}

.purple-dot {
  color: #D5007F; /* Purple-pink accent */
  margin-left: 0.25rem;
}
```

### OffCanvasMenu Component Implementation
[Source: idea.md - Interactive components section, changes.md section 5]

**Recommended Implementation (Framer Motion):**

```tsx
// src/components/layout/OffCanvasMenu.tsx
'use client';

import { motion, AnimatePresence } from 'framer-motion';
import { useEffect } from 'react';
import Link from 'next/link';

interface OffCanvasMenuProps {
  isOpen: boolean;
  onClose: () => void;
}

export default function OffCanvasMenu({ isOpen, onClose }: OffCanvasMenuProps) {
  // Prevent body scroll when menu open
  useEffect(() => {
    if (isOpen) {
      document.body.style.overflow = 'hidden';
    } else {
      document.body.style.overflow = '';
    }
    return () => {
      document.body.style.overflow = '';
    };
  }, [isOpen]);

  // Close on Escape key
  useEffect(() => {
    const handleEscape = (e: KeyboardEvent) => {
      if (e.key === 'Escape' && isOpen) {
        onClose();
      }
    };

    window.addEventListener('keydown', handleEscape);
    return () => window.removeEventListener('keydown', handleEscape);
  }, [isOpen, onClose]);

  const menuVariants = {
    closed: {
      x: '100%',
      transition: { duration: 0.4, ease: 'easeOut' },
    },
    open: {
      x: 0,
      transition: { duration: 0.4, ease: 'easeOut' },
    },
  };

  const backdropVariants = {
    closed: { opacity: 0 },
    open: { opacity: 1 },
  };

  const navLinks = [
    { href: '/', label: 'Home' },
    { href: '/work', label: 'Work' },
    { href: '/about', label: 'About' },
    { href: '/contact', label: 'Contact' },
  ];

  return (
    <AnimatePresence>
      {isOpen && (
        <>
          {/* Backdrop */}
          <motion.div
            className="fixed inset-0 z-40 bg-black/80"
            variants={backdropVariants}
            initial="closed"
            animate="open"
            exit="closed"
            onClick={onClose}
          />

          {/* Menu Panel */}
          <motion.div
            className="fixed inset-y-0 right-0 z-50 w-full bg-black md:w-2/3 lg:w-1/2"
            variants={menuVariants}
            initial="closed"
            animate="open"
            exit="closed"
            role="dialog"
            aria-modal="true"
            aria-label="Navigation menu"
          >
            <nav className="flex h-full flex-col items-center justify-center">
              <ul className="space-y-8">
                {navLinks.map((link) => (
                  <li key={link.href}>
                    <Link
                      href={link.href}
                      onClick={onClose}
                      className="nav-link text-5xl font-bold text-white hover:text-transparent hover:bg-gradient-to-r hover:from-purple-600 hover:to-pink-600 hover:bg-clip-text"
                    >
                      {link.label}
                    </Link>
                  </li>
                ))}
              </ul>
            </nav>

            {/* Close Button */}
            <button
              onClick={onClose}
              className="absolute top-8 right-8 text-white text-4xl"
              aria-label="Close menu"
            >
              ×
            </button>
          </motion.div>
        </>
      )}
    </AnimatePresence>
  );
}
```

### Header Integration
[Source: docs/architecture/unified-project-structure.md]

**Update Header Component:**

```tsx
// src/components/layout/Header.tsx
'use client';

import { useState } from 'react';
import OffCanvasMenu from './OffCanvasMenu';

export default function Header() {
  const [menuOpen, setMenuOpen] = useState(false);

  return (
    <header className="fixed top-0 w-full z-30 bg-black/90 backdrop-blur-sm">
      <div className="container mx-auto flex items-center justify-between px-6 py-4">
        <div className="text-2xl font-bold">UmerFilms</div>

        {/* Menu Toggle Button */}
        <button
          onClick={() => setMenuOpen(true)}
          className="menu-toggle"
          aria-expanded={menuOpen}
          aria-label="Toggle navigation menu"
        >
          <span>MENU</span>
          <span className="purple-dot">•</span>
        </button>
      </div>

      {/* Off-Canvas Menu */}
      <OffCanvasMenu isOpen={menuOpen} onClose={() => setMenuOpen(false)} />
    </header>
  );
}
```

### Focus Trap Implementation
[Source: idea.md - Semantic & accessible section]

**Using focus-trap-react:**

```bash
npm install focus-trap-react
```

```tsx
import FocusTrap from 'focus-trap-react';

<FocusTrap active={isOpen}>
  <div role="dialog" aria-modal="true">
    {/* Menu content */}
  </div>
</FocusTrap>
```

**Or custom implementation:**

```typescript
useEffect(() => {
  if (!isOpen) return;

  const menuElement = menuRef.current;
  if (!menuElement) return;

  const focusableElements = menuElement.querySelectorAll(
    'a, button, input, textarea, select, [tabindex]:not([tabindex="-1"])'
  );

  const firstElement = focusableElements[0] as HTMLElement;
  const lastElement = focusableElements[focusableElements.length - 1] as HTMLElement;

  const handleTab = (e: KeyboardEvent) => {
    if (e.key !== 'Tab') return;

    if (e.shiftKey) {
      // Shift + Tab
      if (document.activeElement === firstElement) {
        e.preventDefault();
        lastElement.focus();
      }
    } else {
      // Tab
      if (document.activeElement === lastElement) {
        e.preventDefault();
        firstElement.focus();
      }
    }
  };

  menuElement.addEventListener('keydown', handleTab);
  firstElement?.focus();

  return () => menuElement.removeEventListener('keydown', handleTab);
}, [isOpen]);
```

### Animation Timing
[Source: idea.md - Animations section]

**Slide Animation:**
- Duration: 0.4s
- Easing: ease-out
- Direction: Right to left (translateX: 100% → 0%)

**Backdrop Animation:**
- Duration: 0.4s
- Easing: ease-out
- Opacity: 0 → 1

### Navigation Links Styling
[Source: idea.md - Typography section]

**Link Styles:**
```css
.nav-link {
  font-size: clamp(2.5rem, 6vw, 5rem);
  font-weight: 700;
  color: #FFFFFF;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  transition: all 0.3s ease;
  position: relative;
}

.nav-link:hover {
  background: linear-gradient(135deg, #450E93 0%, #D5007F 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* Sliding underline effect */
.nav-link::after {
  content: '';
  position: absolute;
  bottom: -0.5rem;
  left: 0;
  width: 0;
  height: 3px;
  background: linear-gradient(135deg, #450E93 0%, #D5007F 100%);
  transition: width 0.3s ease;
}

.nav-link:hover::after {
  width: 100%;
}
```

### Responsive Behavior
[Source: idea.md - Layout & grids section]

**Breakpoints:**
- Mobile (<768px): Full width overlay
- Tablet (768-1024px): 2/3 width overlay
- Desktop (>1024px): 1/2 width overlay

**Responsive Styles:**
```css
.off-canvas-menu {
  width: 100%;
}

@media (min-width: 768px) {
  .off-canvas-menu {
    width: 66.666%;
  }
}

@media (min-width: 1024px) {
  .off-canvas-menu {
    width: 50%;
  }
}
```

### Body Scroll Lock
[Source: Best practices]

**Prevent scroll when menu open:**
```typescript
useEffect(() => {
  if (isOpen) {
    // Store scroll position
    const scrollY = window.scrollY;

    document.body.style.position = 'fixed';
    document.body.style.top = `-${scrollY}px`;
    document.body.style.width = '100%';
  } else {
    // Restore scroll position
    const scrollY = document.body.style.top;
    document.body.style.position = '';
    document.body.style.top = '';
    document.body.style.width = '';

    window.scrollTo(0, parseInt(scrollY || '0') * -1);
  }
}, [isOpen]);
```

### Component Testing
[Source: docs/architecture/testing-strategy.md]

**Test File:** `src/components/layout/OffCanvasMenu.test.tsx`

```typescript
import { render, screen, fireEvent } from '@testing-library/react';
import { describe, it, expect, vi } from 'vitest';
import OffCanvasMenu from './OffCanvasMenu';

describe('OffCanvasMenu', () => {
  const mockOnClose = vi.fn();

  it('renders when open', () => {
    render(<OffCanvasMenu isOpen={true} onClose={mockOnClose} />);
    expect(screen.getByRole('dialog')).toBeInTheDocument();
  });

  it('does not render when closed', () => {
    render(<OffCanvasMenu isOpen={false} onClose={mockOnClose} />);
    expect(screen.queryByRole('dialog')).not.toBeInTheDocument();
  });

  it('calls onClose when backdrop clicked', () => {
    render(<OffCanvasMenu isOpen={true} onClose={mockOnClose} />);

    const backdrop = screen.getByRole('dialog').previousSibling;
    fireEvent.click(backdrop as Element);

    expect(mockOnClose).toHaveBeenCalled();
  });

  it('calls onClose when Escape pressed', () => {
    render(<OffCanvasMenu isOpen={true} onClose={mockOnClose} />);

    fireEvent.keyDown(window, { key: 'Escape' });

    expect(mockOnClose).toHaveBeenCalled();
  });

  it('calls onClose when navigation link clicked', () => {
    render(<OffCanvasMenu isOpen={true} onClose={mockOnClose} />);

    const homeLink = screen.getByText('Home');
    fireEvent.click(homeLink);

    expect(mockOnClose).toHaveBeenCalled();
  });

  it('has proper ARIA attributes', () => {
    render(<OffCanvasMenu isOpen={true} onClose={mockOnClose} />);

    const dialog = screen.getByRole('dialog');
    expect(dialog).toHaveAttribute('aria-modal', 'true');
    expect(dialog).toHaveAttribute('aria-label');
  });

  it('prevents body scroll when open', () => {
    render(<OffCanvasMenu isOpen={true} onClose={mockOnClose} />);
    expect(document.body.style.overflow).toBe('hidden');
  });
});
```

### Dependencies
[Source: Epic 4 definition]

**Story Dependencies:**
- Depends on Story 4.1 (color palette) for purple-pink accent
- Depends on Story 4.4 (preloader) being complete
- Should be implemented before major sections

**Package Dependencies:**
```bash
npm install framer-motion        # For animations
npm install focus-trap-react     # For focus management (optional)
```

### Accessibility Requirements
[Source: idea.md - Semantic & accessible section]

**WCAG Compliance:**
- Keyboard navigation (Tab, Shift+Tab, Escape)
- Focus trap within menu
- Screen reader announcements
- Focus return to trigger on close
- ARIA attributes for dialog

**Implementation Checklist:**
- [ ] role="dialog"
- [ ] aria-modal="true"
- [ ] aria-label or aria-labelledby
- [ ] aria-expanded on toggle button
- [ ] Focus trap active when open
- [ ] Escape key closes menu
- [ ] Focus returns to button on close

### Visual Design
[Source: idea.md section 3, changes.md section 5]

**Menu Button:**
- Pill-shaped (border-radius: 2rem)
- White background (#FFFFFF)
- Black text (#000000)
- Purple dot (#D5007F)
- Hover: Black background, white text

**Overlay:**
- Fullscreen fixed position
- Dark background (#000000)
- Slides in from right
- Large navigation links (3-5rem)
- Purple-pink gradient on hover

### Implementation Order
1. ✅ Create OffCanvasMenu component
2. ✅ Add menu toggle button to header
3. ✅ Implement slide animations
4. ✅ Add navigation links
5. ✅ Implement keyboard accessibility
6. ✅ Add focus trap
7. ✅ Implement body scroll lock
8. ✅ Write component tests
9. ✅ Accessibility testing

## Testing

[Source: docs/architecture/testing-strategy.md]

**Test Types:**
1. **Component Tests:** Toggle, close, navigation
2. **Accessibility Tests:** ARIA, keyboard, focus management
3. **Visual Tests:** Animation smoothness
4. **Responsive Tests:** Mobile, tablet, desktop

**Test Commands:**
```bash
npm test                           # Run all tests
npm test OffCanvasMenu.test        # Test menu specifically
```

**Expected Results:**
- Menu opens and closes smoothly
- Keyboard navigation works
- Focus is trapped and managed
- Accessible to screen readers

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-14 | 1.0 | Initial story draft | Claude |

## Dev Agent Record

### Agent Model Used
_To be filled by dev agent_

### Debug Log References
_To be filled by dev agent_

### Completion Notes List
_To be filled by dev agent_

### File List
_To be filled by dev agent_

## QA Results
_To be filled by QA agent after implementation_
